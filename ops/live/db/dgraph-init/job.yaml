apiVersion: batch/v1
kind: Job
metadata:
  generateName: dgraph-init
  annotations:
    argocd.argoproj.io/hook: PostSync
spec:
  completions: 1
  parallelism: 1
  backoffLimit: 10
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: dgraph-init
          image: adiffhunting/db-dgraph-init:0927d8b
          env:
            - name: DEBUG
              value: "false"
            - name: DGRAPH_ALPHA_HOST
              value: "dgraph-alpha.db"
            - name: DGRAPH_ALPHA_HTTP_PORT
              value: "8080"
          resources:
            requests:
              cpu: 10m
              memory: 32Mi
            limits:
              memory: 32Mi
          volumeMounts:
            - name: init-data
              mountPath: /src/data
              readOnly: true
      volumes:
        - name: init-data
          secret:
            secretName: init-data
